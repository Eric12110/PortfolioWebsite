<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>相簿瀏覽</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body oncontextmenu="return false;">
    <div id="headerContainer"></div>
    <div class="container py-5">
        <a href="javascript:history.back()" class="btn btn-secondary mb-4">← 返回分類</a>
        <div class="container my-3">
            <p id="albumDescriptionContainer" class="text-muted"></p>
        </div>
        <h2 id="album-title" class="mb-4">相簿名稱</h2>
        <div class="row g-4" id="photo-list"></div>
    </div>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBg8EzN4UcX0g1JQ-6rhzSHLu_RD5NIPJA",
            authDomain: "loginregistration-1dba1.firebaseapp.com",
            databaseURL: "https://loginregistration-1dba1-default-rtdb.firebaseio.com",
            projectId: "loginregistration-1dba1",
            storageBucket: "loginregistration-1dba1.firebasestorage.app",
            messagingSenderId: "445119046757",
            appId: "1:445119046757:web:3ee19609f46b8a9b91928c",
            measurementId: "G-FWEP0T45HC"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const params = new URLSearchParams(window.location.search);
        const category = params.get('category');
        const person = params.get('person');

        document.getElementById('album-title').textContent = `${person} 的相簿`;
        database.ref(`${category}/${person}/_meta`).once("value").then(metaSnap => {
            const desc = metaSnap.val()?.description || "";
            document.getElementById("albumDescriptionContainer").innerText = desc;
        });
        function loadAlbumPhotos(category, person) {
            const container = document.getElementById('photo-list');

            database.ref(`${category}/${person}`).once('value').then(snapshot => {
                if (!snapshot.exists()) {
                    container.innerHTML = "<p class='text-muted'>找不到任何照片。</p>";
                    return;
                }

                snapshot.forEach(photoSnap => {
                    const key = photoSnap.key;
                    if (key === '_meta') {
                        // 忽略 _meta 節點
                        return;
                    }
                    const data = photoSnap.val();

                    const col = document.createElement("div");
                    col.className = "col-md-4 col-sm-6";

                    col.innerHTML = `
            <div class="card h-100 shadow-sm">
              <img src="${data.url}" class="card-img-top" style="height: 300px; object-fit: cover;">
              <div class="card-body text-center p-2">
                <small class="text-muted">${data.name || ''}</small>
              </div>
            </div>
          `;

                    container.appendChild(col);
                });
            });
        }

        loadAlbumPhotos(category, person);
        fetch('header.html')
      .then(response => response.text())
      .then(html => {
        document.getElementById('headerContainer').innerHTML = html;
      })
      .catch(err => {
        console.error('載入 header 失敗', err);
      });
    </script>
</body>

</html>