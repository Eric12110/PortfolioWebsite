<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ç›¸ç°¿åˆ†é¡</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Noto+Sans+TC&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body oncontextmenu="return false;">
    <div id="headerContainer"></div>
    <div class="container py-5">
        <h2 id="album-title" class="mb-4">åˆ†é¡ç›¸ç°¿</h2>
        <div id="gallery" class="container py-4"></div>
    </div>

    <script>
        // âœ… åˆå§‹åŒ– Firebaseï¼ˆè«‹å¡«å…¥ä½ çš„ configï¼‰
        const firebaseConfig = {
            apiKey: "AIzaSyBg8EzN4UcX0g1JQ-6rhzSHLu_RD5NIPJA",
            authDomain: "loginregistration-1dba1.firebaseapp.com",
            databaseURL: "https://loginregistration-1dba1.asia-southeast1.firebasedatabase.app",
            projectId: "loginregistration-1dba1",
            storageBucket: "loginregistration-1dba1.firebasestorage.app",
            messagingSenderId: "445119046757",
            appId: "1:445119046757:web:3ee19609f46b8a9b91928c",
            measurementId: "G-FWEP0T45HC"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // âœ… æŠ“å– query string å…§çš„åˆ†é¡
        const params = new URLSearchParams(window.location.search);
        const category = params.get('category') || 'Wedding';

        document.getElementById('album-title').textContent = `ğŸ“· åˆ†é¡ï¼š${category}`;
        function loadAlbumsByCategory(category) {
            const gallery = document.getElementById("gallery");
            gallery.innerHTML = "";
            console.log(`è¼‰å…¥åˆ†é¡ï¼š${category}`);
            database.ref('Family').once("value").then(snapshot => {
                console.log("Snapshot:", snapshot.val());
            });
            database.ref(category).once("value").then(snapshot => {
                if (!snapshot.exists()) {
                    gallery.innerHTML = "<p class='text-muted'>æ‰¾ä¸åˆ°ä»»ä½•è³‡æ–™ã€‚</p>";
                    return;
                }

                const row = document.createElement("div");
                row.className = "row g-4";

                snapshot.forEach(personSnap => {
                    const personName = personSnap.key;
                    // åƒ…å–å¾—å…·æœ‰ `url` å±¬æ€§çš„ç…§ç‰‡
                    const photos = Object.values(personSnap.val()).filter(item => item.url);
                    // å–å¾—ç¬¬ä¸€å¼µä½œç‚ºå°é¢
                    const coverPhoto = photos[0]?.url || "";

                    const col = document.createElement("div");
                    col.className = "col-md-4 col-sm-6";
                    if(photos.length === 0) {
                        return;
                    }
                    col.innerHTML = `
                        <a href="album.html?category=${category}&person=${encodeURIComponent(personName)}" style="text-decoration: none;">
                        <div class="card shadow-sm h-100">
                            <img src="${coverPhoto}" class="card-img-top" style="height: 250px; object-fit: cover;">
                            <div class="card-body text-center">
                            <h5 class="card-title">${personName}</h5>
                            <p class="card-text text-muted">${photos.length} å¼µç…§ç‰‡</p>
                            </div>
                        </div>
                        </a>
                    `;
                    row.appendChild(col);
                });

                gallery.appendChild(row);
            });
        }



        document.addEventListener("DOMContentLoaded", () => {
            // âœ… é–‹å§‹è¼‰å…¥
            loadAlbumsByCategory(category);
        });
        fetch('header.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('headerContainer').innerHTML = html;
            })
            .catch(err => {
                console.error('è¼‰å…¥ header å¤±æ•—', err);
            });
    </script>
</body>

</html>